rule Malicious_WebP {
  meta:
    description = "Detects a specific malicious WebP file from CVE-2023-4863 POC https://github.com/mistymntncop/CVE-2023-4863 - aditionnaly hunting for .webp file creation from unusual process could be a good idea"
    author = "mthcht"
    date = "2023-10-05"

  strings:
    // RIFF header for WebP
    $header = { 52 49 46 46 e9 00 00 00 57 45 42 50 56 50 38 4C }

    // Some unique byte sequences from the malicious file
    $unique1 = { dd 00 00 00 2f 00 00 00 00 f0 00 5a 00 00 b0 ac }
    $unique2 = { 25 9d 9b 04 00 00 00 00 00 00 00 00 00 00 00 00 }
    $unique3 = { b4 6d db b6 6d db b6 6d db b6 6d db b6 6d db f6 }
    $unique4 = { fd d9 f5 00 58 00 00 b0 b4 e5 cc 49 92 24 00 00 }

  condition:
    $header at 0 and 1 of ($unique*)
}
